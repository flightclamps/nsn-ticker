<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1080, height=1920, initial-scale=1.0">
    <title>NotsoCJ Pro Broadcast System</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. CORE SYSTEM --- */
        :root {
            --brand-red: #E50914;
            --brand-dark: #0a0a0a;
            --brand-gold: #FFD700;
            --glass-bg: rgba(10, 10, 10, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--brand-dark);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            width: 100vw; height: 100vh;
        }

        /* --- 2. GALAXY ENGINE --- */
        #galaxyCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            transition: filter 1s ease;
        }

        /* --- 3. BROADCAST HEADER (TOP STACK) --- */
        .broadcast-island {
            position: absolute;
            top: 80px; left: 50%; transform: translateX(-50%);
            width: 96%;
            display: flex; flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            border: 1px solid var(--glass-border);
            overflow: hidden;
        }

        /* SCOREBOARD ROW */
        .score-row {
            width: 100%; height: 120px;
            display: flex; align-items: center;
            position: relative;
            z-index: 20;
        }

        /* BRANDING */
        .brand-box {
            width: 130px; height: 100%;
            background: var(--brand-red);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%);
            padding-right: 15px; z-index: 5;
        }
        .brand-title { font-family: 'Oswald'; font-weight: 700; font-size: 22px; line-height: 1; }
        .brand-handle { font-size: 10px; opacity: 0.9; margin-top: 4px; font-weight: 600; }

        /* TEAMS */
        .matchup-container {
            flex: 1; display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px 0 5px; height: 100%;
        }
        .team-group { display: flex; align-items: center; gap: 10px; width: 35%; }
        .team-group.away { justify-content: flex-end; text-align: right; }
        
        .team-logo img { width: 55px; height: 55px; object-fit: contain; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5)); }
        .team-score { font-family: 'Oswald'; font-size: 42px; font-weight: 700; line-height: 1; }
        
        /* CLOCK (CENTER STACK) */
        .game-info {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 20%; background: rgba(255,255,255,0.05); padding: 6px; border-radius: 6px;
        }
        .clock-main { font-family: 'Oswald'; font-size: 20px; color: var(--brand-gold); font-weight: 700; }
        .quarter-sub { font-family: 'Inter'; font-size: 10px; color: #aaa; font-weight: 700; text-transform: uppercase; }

        /* --- 4. BATTLE BAR (Engagement) --- */
        .battle-bar-wrapper {
            width: 94%; height: 30px;
            margin-top: -5px; 
            background: black;
            border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;
            position: relative; overflow: hidden;
            display: flex; align-items: center;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            z-index: 15;
        }
        
        .battle-fill {
            height: 100%; transition: width 0.5s ease-out;
            display: flex; align-items: center; overflow: hidden;
        }
        .battle-left { 
            background: linear-gradient(90deg, #1a1a1a, #333); 
            justify-content: flex-start; padding-left: 10px;
        }
        .battle-right { 
            background: linear-gradient(90deg, #333, #1a1a1a); 
            justify-content: flex-end; padding-right: 10px; 
            flex-grow: 1;
        }
        
        .battle-text { font-family: 'Oswald'; font-size: 12px; font-weight: 700; text-transform: uppercase; white-space: nowrap; opacity: 0.8; }
        .battle-marker { width: 4px; height: 100%; background: #fff; box-shadow: 0 0 10px white; z-index: 5; }

        /* --- 5. NEWS TICKER --- */
        .news-ticker-wrapper {
            width: 96%; height: 45px;
            margin-top: 8px; 
            display: flex; align-items: center;
            z-index: 10;
        }
        .news-label {
            width: 90px; height: 100%; background: var(--brand-gold); color: black;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Oswald'; font-weight: 700; font-size: 16px;
            clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%); z-index: 5;
        }
        .ticker-content { flex: 1; height: 100%; position: relative; overflow: hidden; }
        .ticker-item {
            position: absolute; top: 50%; transform: translateY(-50%);
            white-space: nowrap; font-size: 18px; font-weight: 600; display: flex; gap: 10px;
        }
        .t-news { color: white; }
        .t-injury { color: #ff4444; font-weight: 700; }

        /* --- 6. PLAYER SPOTLIGHT (UPDATED FOR REAL DATA) --- */
        .player-card {
            position: absolute; right: -450px; top: 250px;
            width: 380px; height: 120px;
            background: rgba(15,15,15,0.95);
            border-left: 6px solid var(--brand-gold);
            padding: 0; border-radius: 8px;
            box-shadow: -10px 10px 30px rgba(0,0,0,0.5);
            transition: right 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 5;
            display: flex; overflow: hidden;
        }
        .player-card.active { right: 20px; }
        
        .pc-img-container {
            width: 120px; height: 100%;
            background: #222;
            position: relative;
        }
        .pc-img-container img {
            width: 100%; height: 100%; object-fit: cover; object-position: top;
        }
        
        .pc-info {
            flex: 1; padding: 15px;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .pc-header { font-family: 'Oswald'; color: var(--brand-gold); font-size: 12px; margin-bottom: 2px; text-transform: uppercase;}
        .pc-name { font-size: 20px; font-weight: 800; color: white; line-height: 1.1; margin-bottom: 4px;}
        .pc-stat { font-family: 'Inter'; font-size: 14px; color: #ccc; font-weight: 600; }
        .pc-team { position: absolute; bottom: 5px; right: 10px; font-size: 10px; color: #555; font-weight: 900; }

        /* --- 7. ADMIN --- */
        .admin-panel {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px; background: #111; border: 1px solid #333;
            padding: 20px; display: none; flex-direction: column; gap: 10px; z-index: 9999;
        }
        .admin-panel.visible { display: flex; }
        .grid-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 10px; background: #333; color: white; border:none; cursor: pointer; font-family: 'Oswald'; }

    </style>
</head>
<body>

    <!-- BACKGROUND -->
    <canvas id="galaxyCanvas"></canvas>

    <!-- TOP BROADCAST ISLAND -->
    <div class="broadcast-island">
        <!-- SCOREBOARD -->
        <div class="glass-panel score-row">
            <div class="brand-box">
                <div class="brand-title">NOTSO CJ</div>
                <div class="brand-handle">@notso_cj</div>
            </div>
            <div class="matchup-container" id="matchupDisplay">
                <div style="width:100%; text-align:center; opacity:0.5">LOADING DATA...</div>
            </div>
        </div>

        <!-- BATTLE BAR -->
        <div class="battle-bar-wrapper">
            <div class="battle-fill battle-left" id="battleLeft" style="width: 50%;">
                <span class="battle-text" id="battleTextLeft">HOME 50%</span>
            </div>
            <div class="battle-marker"></div>
            <div class="battle-right">
                <span class="battle-text" id="battleTextRight" style="margin-right:10px;">AWAY 50%</span>
            </div>
        </div>

        <!-- NEWS TICKER -->
        <div class="glass-panel news-ticker-wrapper">
            <div class="news-label">NEWS</div>
            <div class="ticker-content">
                <div class="ticker-track" id="newsTrack"></div>
            </div>
        </div>
    </div>

    <!-- PLAYER SPOTLIGHT POPUP -->
    <div class="glass-panel player-card" id="playerCard">
        <div class="pc-img-container">
            <img id="pcImg" src="" onerror="this.style.display='none'">
        </div>
        <div class="pc-info">
            <div class="pc-header" id="pcLabel">IMPACT PLAYER</div>
            <div class="pc-name" id="pcName">LOADING...</div>
            <div class="pc-stat" id="pcStat">WAITING FOR DATA</div>
            <div class="pc-team" id="pcTeam">ESPN</div>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div class="admin-panel" id="adminPanel">
        <div style="color:#888; font-size:12px;">COMMAND CENTER v10.0</div>
        <div class="grid-btns">
            <button class="btn" onclick="dataService.manualNext()">NEXT GAME</button>
            <button class="btn" onclick="battleSystem.push('home')">PUSH HOME</button>
            <button class="btn" onclick="battleSystem.push('away')">PUSH AWAY</button>
            <button class="btn" onclick="spotlight.trigger()">SHOW PLAYER</button>
        </div>
    </div>

    <script>
        // --- 1. GALAXY ---
        class Galaxy {
            constructor() {
                this.canvas = document.getElementById('galaxyCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.stars = [];
                this.resize(); window.addEventListener('resize', ()=>this.resize());
                this.init(); this.loop();
            }
            resize() { this.canvas.width = innerWidth; this.canvas.height = innerHeight; }
            init() { for(let i=0; i<200; i++) this.stars.push({x:Math.random()*this.canvas.width, y:Math.random()*this.canvas.height, s:Math.random()*1.5, v:Math.random()*0.5}); }
            loop() {
                this.ctx.fillStyle = '#000'; this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
                this.ctx.fillStyle = '#fff';
                this.stars.forEach(st => {
                    st.y -= st.v; if(st.y<0) st.y = this.canvas.height;
                    this.ctx.beginPath(); this.ctx.arc(st.x, st.y, st.s, 0, Math.PI*2); this.ctx.fill();
                });
                requestAnimationFrame(()=>this.loop());
            }
        }

        // --- 2. DATA SERVICE (REAL STATS) ---
        class DataService {
            constructor() {
                this.api = 'https://site.api.espn.com/apis/site/v2/sports';
                this.games = [];
                this.news = [];
                this.impactPlayers = []; // STORE REAL PLAYERS
                this.idx = 0;
                this.leagues = [{s:'football',l:'nfl',n:'NFL'}, {s:'basketball',l:'nba',n:'NBA'}];
                this.start();
            }
            
            async start() {
                await this.fetch();
                setInterval(()=>this.fetch(), 60000);
                setInterval(()=>this.cycleGame(), 15000);
            }

            async fetch() {
                let g = [], n = [], p = [];
                for(let lg of this.leagues) {
                    try {
                        let sRes = await fetch(`${this.api}/${lg.s}/${lg.l}/scoreboard`);
                        let sData = await sRes.json();
                        if(sData.events) {
                            sData.events.forEach(e => {
                                g.push(this.parseGame(e, lg.n));
                                p.push(...this.extractPlayers(e)); // GET PLAYERS
                            });
                        }

                        let nRes = await fetch(`${this.api}/${lg.s}/${lg.l}/news`);
                        let nData = await nRes.json();
                        if(nData.articles) n.push(...nData.articles.map(a=>({text:a.headline, type:'news'})));
                    } catch(e) {}
                }
                g.sort((a,b) => (a.live===b.live)?0 : a.live?-1:1);
                if(g.length) this.games = g;
                if(n.length) { this.news = n; if(window.ticker) window.ticker.update(n); }
                if(p.length) this.impactPlayers = p; // UPDATE PLAYER POOL
                this.updateUI();
            }

            parseGame(e, lg) {
                let c = e.competitions[0];
                let h = c.competitors.find(x=>x.homeAway==='home');
                let a = c.competitors.find(x=>x.homeAway==='away');
                return {
                    league: lg,
                    time: e.status.type.shortDetail,
                    hT: h.team.abbreviation, hS: h.score, hL: h.team.logo,
                    aT: a.team.abbreviation, aS: a.score, aL: a.team.logo,
                    live: e.status.type.state === 'in'
                };
            }

            extractPlayers(e) {
                // Extracts Leaders from the API Response
                let players = [];
                let c = e.competitions[0];
                if(c.competitors) {
                    c.competitors.forEach(team => {
                        if(team.leaders) {
                            team.leaders.forEach(cat => {
                                if(cat.leaders) {
                                    cat.leaders.forEach(ldr => {
                                        players.push({
                                            name: ldr.athlete.displayName,
                                            stat: ldr.displayValue,
                                            desc: cat.displayName, // e.g. Passing, Receiving
                                            headshot: ldr.athlete.headshot ? ldr.athlete.headshot.href : '',
                                            team: team.team.abbreviation
                                        });
                                    });
                                }
                            });
                        }
                    });
                }
                return players;
            }

            cycleGame() {
                if(!this.games.length) return;
                this.idx = (this.idx + 1) % this.games.length;
                this.updateUI();
            }
            
            manualNext() { this.cycleGame(); }

            updateUI() {
                if(!this.games.length) return;
                let g = this.games[this.idx];
                let tParts = g.time.split(" - ");
                let topT = tParts[0] || g.time; 
                let botT = tParts[1] || "";
                
                document.getElementById('matchupDisplay').innerHTML = `
                    <div class="team-group away">
                        <div class="team-score">${g.aS}</div>
                        <div class="team-logo"><img src="${g.aL}"></div>
                    </div>
                    <div class="game-info">
                        <div class="quarter-sub">${g.league}</div>
                        <div class="clock-main">${topT}</div>
                        <div class="quarter-sub">${botT}</div>
                    </div>
                    <div class="team-group home">
                        <div class="team-logo"><img src="${g.hL}"></div>
                        <div class="team-score">${g.hS}</div>
                    </div>
                `;
            }
        }

        // --- 3. BATTLE SYSTEM ---
        class BattleSystem {
            constructor() {
                this.val = 50; 
                this.bar = document.getElementById('battleLeft');
                this.txtL = document.getElementById('battleTextLeft');
                this.txtR = document.getElementById('battleTextRight');
                setInterval(() => this.drift(), 2000);
            }
            push(side) {
                if(side === 'home') this.val = Math.min(90, this.val + 5);
                else this.val = Math.max(10, this.val - 5);
                this.render();
            }
            drift() {
                let move = (Math.random() * 4) - 2; 
                this.val = Math.min(90, Math.max(10, this.val + move));
                this.render();
            }
            render() {
                this.bar.style.width = this.val + '%';
                this.txtL.innerText = `HOME ${Math.round(this.val)}%`;
                this.txtR.innerText = `AWAY ${Math.round(100-this.val)}%`;
            }
        }

        // --- 4. NEWS TICKER ---
        class NewsTicker {
            constructor() {
                this.track = document.getElementById('newsTrack');
                this.items = [];
                this.data = ["Waiting for ESPN News..."];
                this.animate();
            }
            update(newData) { this.data = newData; }
            animate() {
                this.items.forEach(i => { i.x -= 1.5; i.el.style.left = i.x+'px'; });
                if(this.items.length && this.items[0].x < -800) { this.items[0].el.remove(); this.items.shift(); }
                let last = this.items[this.items.length-1];
                let right = last ? last.x + last.el.offsetWidth : 0;
                if(right < window.innerWidth) this.spawn(right + 50);
                requestAnimationFrame(()=>this.animate());
            }
            spawn(x) {
                let item = this.data[Math.floor(Math.random()*this.data.length)];
                let text = item.text || item;
                let isInj = text.toLowerCase().includes('injury');
                let el = document.createElement('div');
                el.className = 'ticker-item';
                el.innerHTML = `<span style="color:${isInj?'#f00':'#fb0'}">>></span> <span style="color:${isInj?'#faa':'#fff'}">${text}</span>`;
                this.track.appendChild(el);
                this.items.push({el, x});
            }
        }

        // --- 5. PLAYER SPOTLIGHT (REAL DATA) ---
        class Spotlight {
            constructor() {
                setInterval(() => { if(Math.random()>0.6) this.trigger(); }, 45000); 
            }
            trigger() {
                // Get random player from real pool
                if(!dataService.impactPlayers.length) return;
                let p = dataService.impactPlayers[Math.floor(Math.random()*dataService.impactPlayers.length)];
                
                document.getElementById('pcName').innerText = p.name;
                document.getElementById('pcStat').innerText = p.stat;
                document.getElementById('pcLabel').innerText = p.desc.toUpperCase() + " LEADER";
                document.getElementById('pcTeam').innerText = p.team;
                
                let img = document.getElementById('pcImg');
                if(p.headshot) {
                    img.src = p.headshot;
                    img.style.display = 'block';
                } else {
                    img.style.display = 'none';
                }
                
                let card = document.getElementById('playerCard');
                card.classList.add('active');
                setTimeout(() => card.classList.remove('active'), 8000);
            }
        }

        // --- INIT ---
        const galaxy = new Galaxy();
        const dataService = new DataService();
        const battleSystem = new BattleSystem();
        window.ticker = new NewsTicker();
        const spotlight = new Spotlight();

        document.addEventListener('keydown', e => { 
            if(e.key==='`') document.getElementById('adminPanel').classList.toggle('visible'); 
        });

    </script>
</body>
</html>


