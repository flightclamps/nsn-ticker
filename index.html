<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NSN Broadcast Ticker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  /* Base Styles */
  body {
    margin: 0;
    background: #000;
    overflow: hidden;
    font-family: 'Inter', Arial, sans-serif;
  }
  
  /* --- RGB ANIMATION DEFINITION --- */
  /* A smooth, continuous cycle through "Tech/Gamer" colors (Cyan, Purple, Pink, Green) */
  @keyframes rgb-flow {
      0% { 
          border-color: #00E5FF; /* Cyan */
          box-shadow: 0 0 15px rgba(0, 229, 255, 0.2);
      }
      25% { 
          border-color: #D500F9; /* Purple */
          box-shadow: 0 0 15px rgba(213, 0, 249, 0.2);
      }
      50% { 
          border-color: #FF4081; /* Pink */
          box-shadow: 0 0 15px rgba(255, 64, 129, 0.2);
      }
      75% { 
          border-color: #00E676; /* Green */
          box-shadow: 0 0 15px rgba(0, 230, 118, 0.2);
      }
      100% { 
          border-color: #00E5FF; /* Back to Cyan */
          box-shadow: 0 0 15px rgba(0, 229, 255, 0.2);
      }
  }

  /* The main container for the ticker strip */
  .nsn-bar {
    width: 100vw;
    height: 52px;
    background: #090909;
    /* Initial border settings (will be overridden by animation) */
    border-top: 3px solid #00E5FF; 
    border-bottom: 3px solid #00E5FF; 
    display: flex;
    align-items: center;
    position: relative; 
    
    /* Apply the RGB Animation */
    animation: rgb-flow 10s linear infinite;
  }

  /* 1. LEFT: Fixed Logo/Network Branding Section */
  .nsn-logo {
    width: 140px; 
    min-width: 140px;
    height: 100%;
    background: linear-gradient(135deg, #B71C1C, #000000); /* Deep Red Gradient */
    
    /* Right border matches the RGB flow */
    border-right: 2px solid #00E5FF; 
    animation: rgb-flow 10s linear infinite;
    box-shadow: none; /* Reset shadow for inner element so it doesn't double up */

    display: flex;
    flex-direction: column;
    justify-content: center; 
    align-items: center;     
    flex-shrink: 0;
    z-index: 20; 
    position: relative;
  }

  /* "NSN LIVE" Title */
  .nsn-title {
    font-size: 24px;
    font-weight: 900;
    color: #FFFFFF;
    font-style: italic;
    letter-spacing: 1px;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
    line-height: 1;
    margin-bottom: 2px; 
  }
  
  /* "POWERED BY: NSN NATION" */
  .nsn-powered {
      font-size: 9px;
      color: #00E5FF;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
      /* Make this text subtly cycle too? Optional, kept cyan for contrast against red bg */
      animation: text-rgb-flow 10s linear infinite;
  }
  
  @keyframes text-rgb-flow {
      0% { color: #00E5FF; }
      25% { color: #D500F9; }
      50% { color: #FF4081; }
      75% { color: #00E676; }
      100% { color: #00E5FF; }
  }

  /* 2. CENTER: The Scrolling Area */
  .scroll-area {
    flex: 1;
    height: 100%;
    overflow: hidden;
    position: relative;
    /* Mask to fade text out before it hits the clock */
    mask-image: linear-gradient(to right, 
      transparent 0%, 
      black 2%, 
      black 90%, 
      transparent 100%
    );
  }

  .scroll-track {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    display: flex; 
    align-items: center;
    white-space: nowrap;
    font-size: 22px; 
    font-weight: 700;
    color: #FFFFFF;
    padding-left: 20px; 
    transition: transform 0s linear; 
    letter-spacing: -0.2px; 
  }

  .item {
    padding-right: 60px; 
    margin-right: 60px; 
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }
  
  /* 3. RIGHT: Live Local Clock */
  .nsn-clock {
      width: 100px;
      height: 100%;
      background: #111;
      
      /* Left border matches RGB flow */
      border-left: 2px solid #00E5FF;
      animation: rgb-flow 10s linear infinite;
      box-shadow: none;

      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20;
      color: #FFF;
      flex-shrink: 0;
  }
  
  #clock-time {
      font-size: 18px;
      font-weight: 900;
      color: #fff; /* Keep time white for readability */
  }
  
  #clock-zone {
      font-size: 10px;
      color: #888;
      font-weight: 600;
      margin-top: -2px;
  }


  /* --- LABELS --- */
  .label {
    font-weight: 800;
    margin-right: 14px;
    padding: 4px 10px;
    border-radius: 4px;
    color: #000; 
    font-size: 16px;
    text-transform: uppercase;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
  }

  /* Keeping the content labels vivid to stand out against the black bar */
  .label-live { background-color: #FF0033; color: #FFF; animation: pulse 2s infinite; }
  .label-final { background-color: #FFD700; color: #000; }
  .label-upcoming { background-color: #00E5FF; color: #000; }
  .label-news { background-color: #D500F9; color: #FFF; }
  .label-chat { background-color: #651FFF; color: #FFF; }
  .label-analyst { background-color: #FF4081; color: #FFF; }
  .label-injury { background-color: #FF6D00; color: #FFF; }
  .label-rumor { background-color: #AA00FF; color: #FFF; }
  
  @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
  }

  /* Mobile/Responsive Adjustments */
  @media (max-width: 600px) {
    .nsn-bar { height: 44px; }
    .nsn-logo { width: 100px; min-width: 100px; }
    .nsn-title { font-size: 16px; }
    .nsn-powered { font-size: 7px; }
    .scroll-track { font-size: 18px; }
    .label { font-size: 12px; margin-right: 8px; padding: 2px 6px; }
    .item { padding-right: 30px; margin-right: 30px; }
    .nsn-clock { width: 70px; }
    #clock-time { font-size: 14px; }
  }

</style>
</head>

<body>

<div class="nsn-bar">
  <!-- LEFT: Network Branding -->
  <div class="nsn-logo">
    <div class="nsn-title">NSN LIVE</div>
    <div class="nsn-powered">POWERED BY<br>NSN NATION</div>
  </div>

  <!-- CENTER: Ticker Area -->
  <div class="scroll-area">
    <div class="scroll-track" id="track"></div>
  </div>

  <!-- RIGHT: Live Clock -->
  <div class="nsn-clock">
      <div id="clock-time">--:--</div>
      <div id="clock-zone">ET</div>
  </div>
</div>

<script>
  // ============ GLOBAL STATE & SETTINGS ============
  const SPEED_PX_PER_SEC = 80; 
  const PROXY = "https://corsproxy.io/?"; 
  const REFRESH_INTERVAL_MS = 3 * 60 * 1000; 

  const track = document.getElementById("track");
  let animationFrameId = null;
  let lastTime = 0;
  let scrollPosition = 0;
  let contentWidth = 0; 

  // --- CLOCK LOGIC ---
  function updateClock() {
      const now = new Date();
      // Format: 3:45 PM
      const timeString = now.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
      // Get Timezone Name (e.g., EST, CST, PST) - simplified
      const timeZone = now.toLocaleTimeString("en-us", {timeZoneName:'short'}).split(' ')[2] || 'LIVE';
      
      document.getElementById('clock-time').textContent = timeString;
      document.getElementById('clock-zone').textContent = timeZone;
  }
  setInterval(updateClock, 1000);
  updateClock(); // Run immediately

  // --- DATA SOURCES ---
  const scoreSources = [
    { label: "NFL", url: "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard" },
    { label: "CFB", url: "https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard?limit=25&groups=80" }, 
    { label: "NBA", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard" },
    { label: "CBB", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard?limit=25&groups=50" }, 
    { label: "NHL", url: "https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard" },
    { label: "MLB", url: "https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard" },
    { label: "EPL", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/scoreboard" }
  ].map(s => ({ label: s.label, url: PROXY + encodeURIComponent(s.url) }));

  const newsFeeds = [
    { label: "NFL", url: "https://www.espn.com/espn/rss/nfl/news" },
    { label: "NBA", url: "https://www.espn.com/espn/rss/nba/news" },
    { label: "NHL", url: "https://www.espn.com/espn/rss/nhl/news" }
  ].map(f => ({ label: f.label, url: PROXY + encodeURIComponent(f.url) }));
  
  const tiktokEngagementItems = [
    "WELCOME TO NSN LIVE STREAM â€¢ DROP A FOLLOW ON TIKTOK!",
    "ðŸš¨ SONG REQUESTS ARE ON! TYPE '!play Song - Artist' IN CHAT ðŸŽ¶",
    "ðŸ”¥ JOIN THE CLUB FOR 1 COIN! BECOME A MEMBER OF NSN NATION TODAY! ðŸ”¥",
    "POLL: WHO IS THE MOST OVERRATED TEAM? COMMENT BELOW!",
    "BREAKING NEWS: CHECK OUR TIKTOK PAGE FOR UPDATES",
    "TRIVIA: ANSWER IN CHAT FOR A SHOUTOUT!",
  ];

  const analystHotTakes = [
    "ANALYST HOT TAKE: LEBRON JAMES IS *NOT* A TOP 5 PLAYER ALL-TIME!",
    "FIRST TAKE: PATRICK MAHOMES IS THE ONLY GENERATIONAL QB RIGHT NOW.",
    "SKIP BAYLESS: COWBOYS ARE SUPER BOWL BOUND. PERIOD.",
    "NBA HOT TAKE: TATUM NEEDS A 'KILLER INSTINCT' TO WIN A RING.",
    "NFL DEBATE: JALEN HURTS > JOE BURROW. FACTS OVER FEELINGS.",
  ];

  // Helper function to randomize arrays
  function shuffle(a) {
    return a.map(v => [Math.random(), v]).sort((x, y) => x[0] - y[0]).map(p => p[1]);
  }

  async function fetchData(url, retries = 3) {
    for (let i = 0; i < retries; i++) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        return await res.json();
      } catch (e) {
        if (i < retries - 1) {
             await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
        }
      }
    }
    return { events: [] }; 
  }

  async function fetchTextData(url, retries = 3) {
    for (let i = 0; i < retries; i++) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        return await res.text();
      } catch (e) {
        if (i < retries - 1) {
            await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
        }
      }
    }
    return "";
  }

  // --- DATE FORMATTING LOGIC ---
  function formatGameTime(dateStr) {
    try {
      const d = new Date(dateStr);
      const now = new Date();
      const isToday = d.getDate() === now.getDate() && d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      const timeString = d.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
      
      if (isToday) return timeString;
      
      const day = d.toLocaleDateString("en-US", { weekday: 'short' });
      const date = d.toLocaleDateString("en-US", { month: 'numeric', day: 'numeric' });
      return `${day} ${date} ${timeString}`;
    } catch {
      return "TBD";
    }
  }

  function getTeamName(teamObj) {
      let name = teamObj.team?.abbreviation || "TEAM";
      if (teamObj.curatedRank && teamObj.curatedRank.current <= 25) {
          name = `(#${teamObj.curatedRank.current}) ${name}`;
      }
      return name;
  }

  // --- BETTING ODDS GENERATOR (Simulated for robustness) ---
  function getBettingOdds(t1, t2) {
      // In a real app with a paid API, you'd fetch this. Here we simulate lines for visual effect.
      const spread = (Math.random() * 10).toFixed(1);
      const total = Math.floor(Math.random() * (230 - 190 + 1) + 190);
      const favored = Math.random() > 0.5 ? t1 : t2;
      return `<span class="text-green-400 ml-2 text-sm">[LINE: ${favored} -${spread} | O/U ${total}]</span>`;
  }
  
  // ==========================================================
  // CONTENT GENERATORS
  // ==========================================================

  function getChatAndAnalystItems() {
    const items = [];
    const combinedEngagement = [...tiktokEngagementItems, ...analystHotTakes];

    combinedEngagement.forEach(t => { 
        let label = "TIKTOK CHAT"; 
        let text = t;
        let labelClass = "label-chat";

        if (t.includes("ANALYST") || t.includes("BAYLESS") || t.includes("FIRST TAKE") || t.includes("SHOCKER")) {
            label = "HOT TAKE";
            labelClass = "label-analyst";
        } else if (t.includes("SONG REQUESTS") || t.includes("1 COIN")) {
            label = "NSN ALERT";
            labelClass = "label-live"; 
        } else if (t.includes("POLL") || t.includes("TRIVIA")) {
            label = "INTERACT";
            labelClass = "label-upcoming";
        }

        items.push({ label, text, labelClass });
    });
    return items;
  }

  async function getScoreItems() {
    const items = [];

    for (const src of scoreSources) {
      try {
        const data = await fetchData(src.url);
        const events = (data && data.events) ? data.events : [];
        const gamesToAdd = events.filter(ev => ev.status?.type?.state?.toLowerCase() !== 'postponed');

        let added = 0;
        for (const ev of gamesToAdd.slice(0, 15)) { 
          if (added >= 15) { break; }
          
          const comp = ev.competitions?.[0];
          if (!comp || comp.competitors.length < 2) { continue; }

          const status = ev.status?.type || {};
          const desc = (status.description || "").toLowerCase();
          const state = (status.state || "").toLowerCase();
          const short = status.shortDetail || "";
          const isFinal = status.completed || desc.includes("final");
          const isLive = state.includes("in") || desc.includes("live");

          const homeTeam = comp.competitors.find(c => c.homeAway === 'home') || comp.competitors[0];
          const awayTeam = comp.competitors.find(c => c.homeAway === 'away') || comp.competitors[1];
          
          const t1 = getTeamName(awayTeam);
          const t2 = getTeamName(homeTeam);

          let label, labelClass, text;

          if (isFinal) {
            label = `${src.label} FINAL`;
            labelClass = "label-final";
            text = `${t1} ${awayTeam.score} @ ${t2} ${homeTeam.score}` + (short ? ` | ${short}` : "");
          } else if (isLive) {
            label = `${src.label} LIVE`;
            labelClass = "label-live";
            text = `${t1} ${awayTeam.score} @ ${t2} ${homeTeam.score}` + (short ? ` | ${short}` : "");
          } else {
            label = `${src.label}`;
            labelClass = "label-upcoming";
            const timeText = formatGameTime(ev.date); 
            
            // NEW: Add Betting Odds to upcoming games for that "Vegas" feel
            const oddsHtml = getBettingOdds(awayTeam.team?.abbreviation, homeTeam.team?.abbreviation);
            
            text = `${t1} @ ${t2} | ${timeText} ${oddsHtml}`;
          }

          items.push({ label, text, labelClass });
          added++;
        }
      } catch (e) {
        console.error("Score block failed for", src.label, e);
      }
    }
    return items;
  }

  async function getNewsItems() {
    const items = [];
    const parser = new DOMParser();
    const injuryKeywords = ["injury", "out", "surgery", "IR", "questionable", "doubtful"];
    const rumorKeywords = ["rumor", "trade", "source", "report", "talks", "interest"];

    for (const feed of newsFeeds) {
      try {
        const text = await fetchTextData(feed.url);
        if (!text) { continue; }
        const xml = parser.parseFromString(text, "text/xml");
        const newsItems = Array.from(xml.querySelectorAll("item")).slice(0, 4); 

        for (const item of newsItems) {
          const titleNode = item.querySelector("title");
          if (!titleNode || !titleNode.textContent) { continue; }
          
          let title = titleNode.textContent.trim();
          title = title.replace(/^\[.+?\]\s?/, ''); 

          const lowerTitle = title.toLowerCase();
          let label = feed.label + " NEWS";
          let labelClass = "label-news";

          if (injuryKeywords.some(keyword => lowerTitle.includes(keyword))) {
              label = "INJURY REPORT";
              labelClass = "label-injury";
          } else if (rumorKeywords.some(keyword => lowerTitle.includes(keyword))) {
              label = "RUMOR MILL";
              labelClass = "label-rumor";
          }

          items.push({ label: label, text: title.toUpperCase(), labelClass: labelClass });
        }
      } catch (e) {
        console.error("News block failed for", feed.label, e);
      }
    }
    return items;
  }

  function addItemToDOM({ label, text, labelClass }) {
    const span = document.createElement("span");
    span.className = "item";
    const cls = labelClass ? `label ${labelClass}` : "label";
    span.innerHTML = `<span class="${cls}">${label}</span>${text}`;
    track.appendChild(span);
  }

  // ==========================================================
  // MAIN BUILDER
  // ==========================================================
  async function buildTicker() {
    const [chatAndAnalyst, scores, news] = await Promise.all([
      getChatAndAnalystItems(),
      getScoreItems(),
      getNewsItems()
    ]);

    let allItems = [...chatAndAnalyst, ...scores, ...news];
    if (allItems.length === 0) {
        allItems.push({ 
            label: "SYSTEM", 
            text: "DATA FEED UNAVAILABLE. TUNE INTO TIKTOK FOR LIVE UPDATES.", 
            labelClass: "label-final" 
        });
    }

    allItems = shuffle(allItems);
    
    track.innerHTML = "";
    allItems.forEach(item => addItemToDOM(item));

    track.style.transform = 'translateX(0px)'; 
    contentWidth = track.scrollWidth; 
    
    const originalContent = track.innerHTML;
    track.innerHTML += originalContent;

    startAnimation();
  }

  function animate(currentTime) {
    if (!lastTime) lastTime = currentTime;
    const deltaTime = currentTime - lastTime;
    lastTime = currentTime;
    const distanceToMove = (SPEED_PX_PER_SEC / 1000) * deltaTime;
    scrollPosition += distanceToMove;

    if (contentWidth > 0 && scrollPosition >= contentWidth) {
      scrollPosition -= contentWidth;
    }

    track.style.transform = `translateX(-${scrollPosition}px)`;
    animationFrameId = requestAnimationFrame(animate);
  }

  function startAnimation() {
    if (animationFrameId) cancelAnimationFrame(animationFrameId);
    lastTime = 0; 
    scrollPosition = 0; 
    animationFrameId = requestAnimationFrame(animate);
  }

  document.addEventListener("DOMContentLoaded", buildTicker);
  setInterval(buildTicker, REFRESH_INTERVAL_MS); 
</script>

</body>
</html>
