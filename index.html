<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NSN Sports Ticker - RGB EDITION</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">

<style>
  /* --- CORE SETUP --- */
  body {
    margin: 0;
    background: transparent;
    overflow: hidden;
    font-family: 'Roboto Condensed', sans-serif;
  }

  /* --- RGB BORDER ANIMATION --- */
  @keyframes rgb-border-flow {
    0% { border-color: #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.7); }
    20% { border-color: #ff7700; box-shadow: 0 0 15px rgba(255, 119, 0, 0.7); }
    40% { border-color: #00ff00; box-shadow: 0 0 15px rgba(0, 255, 0, 0.7); }
    60% { border-color: #0088ff; box-shadow: 0 0 15px rgba(0, 136, 255, 0.7); }
    80% { border-color: #8800ff; box-shadow: 0 0 15px rgba(136, 0, 255, 0.7); }
    100% { border-color: #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.7); }
  }

  /* --- SCANLINES EFFECT --- */
  .broadcast-overlay {
    position: absolute;
    top: 0; left: 0; width: 100vw; height: 100vh;
    pointer-events: none;
    z-index: 100;
    background: 
      linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), 
      linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.03));
    background-size: 100% 2px, 6px 100%;
    mix-blend-mode: overlay;
  }

  /* --- MAIN BAR CONTAINER --- */
  .pro-ticker {
    width: 100vw;
    height: 68px; 
    background: linear-gradient(180deg, #111111 0%, #0a0a0a 100%);
    border-top: 3px solid #ff0000; 
    border-bottom: 3px solid #ff0000; 
    animation: rgb-border-flow 10s infinite linear;
    display: flex;
    align-items: center;
    position: relative; 
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.7);
    overflow: hidden;
  }

  /* --- LEFT: LOGO --- */
  .ticker-logo {
    width: 200px; 
    min-width: 200px;
    height: 100%;
    background: #000;
    border-right: 2px solid #222; 
    display: flex;
    flex-direction: column;
    justify-content: center; 
    align-items: center;     
    z-index: 50; 
    position: relative;
    overflow: hidden;
  }

  .logo-bg {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, #111 0%, #000 100%);
    z-index: 1;
  }

  /* Typewriter effect for title */
  .ticker-title-container {
    position: relative;
    z-index: 2;
    display: inline-block;
  }
  
  .ticker-title {
    font-family: 'Chakra Petch', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: #FFF;
    letter-spacing: -1px;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    white-space: nowrap;
    overflow: hidden;
    border-right: 3px solid #00FFFF;
    width: 0;
    animation: typing 3.5s steps(11, end) forwards, blink-caret 0.75s step-end infinite;
  }
  
  @keyframes typing {
    from { width: 0 }
    to { width: 175px }
  }
  
  @keyframes blink-caret {
    from, to { border-color: transparent }
    50% { border-color: #00FFFF }
  }

  .ticker-tagline {
    position: relative;
    z-index: 2;
    font-size: 10px;
    color: #999;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 6px;
  }

  /* --- CENTER: SCROLL AREA --- */
  .scroll-area {
    flex: 1;
    height: 100%;
    position: relative;
    background: linear-gradient(180deg, #0c0c0c 0%, #050505 100%);
  }

  .scroll-mask {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: 40;
    pointer-events: none;
    background: linear-gradient(90deg, #090909 0%, transparent 5%, transparent 95%, #090909 100%);
  }

  .scroll-track {
    position: absolute;
    top: 0; left: 0;
    height: 100%;
    display: flex; 
    align-items: center;
    white-space: nowrap;
    padding-left: 30px; 
  }

  /* --- CONTENT ITEMS --- */
  .ticker-item {
    padding-right: 80px; 
    display: flex;
    align-items: center;
    font-size: 24px; 
    font-weight: 600;
    color: #FFFFFF;
    font-family: 'Roboto Condensed', sans-serif;
  }

  .league-badge {
    font-family: 'Chakra Petch', sans-serif;
    font-weight: 700;
    margin-right: 15px;
    padding: 4px 10px;
    font-size: 16px;
    text-transform: uppercase;
    border-radius: 3px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 60px;
    height: 26px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  }
  
  /* League-specific colors */
  .nfl { background: #013369; color: white; }
  .nba { background: #C9082A; color: white; }
  .mlb { background: #041E42; color: white; }
  .nhl { background: #000000; color: white; border: 1px solid #ccc; }
  .mls { background: #1EB53A; color: white; }
  .pga { background: #001D59; color: white; }
  .uefa { background: #000A4E; color: white; }
  .f1 { background: #E10600; color: white; }
  .news { background: #7D3C98; color: white; }
  .live { background: #FF0000; color: white; }
  .final { background: #FFD700; color: black; }

  /* Status indicators */
  .status {
    font-size: 14px;
    font-weight: 700;
    padding: 3px 8px;
    margin-left: 12px;
    border-radius: 3px;
    text-transform: uppercase;
  }
  
  .status-live {
    background: #FF0000;
    color: white;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
  }
  
  .status-final {
    background: #333;
    color: white;
  }
  
  .status-upcoming {
    background: #555;
    color: white;
  }

  /* Highlight content */
  .team-name { font-weight: 700; }
  .team-score { font-weight: 900; margin: 0 5px; }
  .player-stats { color: #00FFFF; font-weight: 700; margin-left: 15px; }
  
  /* --- RIGHT: CLOCK --- */
  .ticker-clock {
    width: 130px;
    min-width: 130px;
    height: 100%;
    background: linear-gradient(135deg, #111 0%, #000 100%);
    border-left: 2px solid #222;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 50;
    position: relative;
  }
  
  #clock-time { 
    font-family: 'Chakra Petch', sans-serif;
    font-size: 24px; 
    font-weight: 700; 
    color: #FFF; 
    letter-spacing: 1px; 
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
  }
  
  #clock-date { 
    font-size: 12px; 
    color: #999; 
    font-weight: 700; 
    margin-top: 2px; 
    text-transform: uppercase; 
  }
</style>
</head>

<body>

<div class="broadcast-overlay"></div>

<div class="pro-ticker" id="main-ticker">
  
  <div class="ticker-logo">
    <div class="logo-bg"></div>
    <div class="ticker-title-container">
      <div class="ticker-title">NSN SPORTS</div>
    </div>
    <div class="ticker-tagline">Powered by NotSoCj‚≠êÔ∏è</div>
  </div>

  <div class="scroll-area">
    <div class="scroll-mask"></div>
    <div class="scroll-track" id="track"></div>
  </div>

  <div class="ticker-clock">
    <div id="clock-time">--:--</div>
    <div id="clock-date">--/--</div>
  </div>

</div>

<script>
  // ============ CONFIGURATION ============
  const SPEED_PX_PER_SEC = 100; 
  const PROXY_URLS = [
    "https://corsproxy.io/?",
    "https://api.allorigins.win/raw?url=",
    "https://cors-anywhere.herokuapp.com/",
    "https://crossorigin.me/",
    "https://thingproxy.freeboard.io/fetch/"
  ];
  
  // Pick a random proxy to distribute load and have fallbacks
  function getProxy() {
    return PROXY_URLS[Math.floor(Math.random() * PROXY_URLS.length)];
  }
  
  const REFRESH_INTERVAL_MS = 120000; // 2 mins
  
  const track = document.getElementById("track");
  
  let scrollPosition = 0;
  let contentWidth = 0; 
  let lastTime = 0;

  // ============ CLOCK ============
  function updateClock() {
    const now = new Date();
    const timeString = now.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
    const dateString = now.toLocaleDateString("en-US", { month: "short", day: "numeric" });
    document.getElementById('clock-time').textContent = timeString;
    document.getElementById('clock-date').textContent = dateString.toUpperCase();
  }
  setInterval(updateClock, 1000);
  updateClock();

  // ============ TYPEWRITER RESET ============
  // Reset typewriter animation periodically
  function resetTypewriter() {
    const title = document.querySelector('.ticker-title');
    title.style.animation = 'none';
    void title.offsetWidth; // Trigger reflow
    title.style.animation = 'typing 3.5s steps(11, end) forwards, blink-caret 0.75s step-end infinite';
  }
  
  // Reset every 10 seconds
  setInterval(resetTypewriter, 10000);

  // ============ DATA FETCHING ============
  
  // Fetch Utilities
  async function fetchData(url) {
    // Try each proxy until one works
    for (let i = 0; i < PROXY_URLS.length; i++) {
      try {
        const proxy = PROXY_URLS[i];
        const res = await fetch(proxy + encodeURIComponent(url), { 
          timeout: 5000, 
          headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' } 
        });
        if (res.ok) {
          return await res.json();
        }
      } catch (e) {
        console.log("Proxy failed, trying next one");
      }
    }
    return { events: [] }; // Return empty data if all proxies fail
  }

  async function fetchText(url) {
    // Try each proxy until one works
    for (let i = 0; i < PROXY_URLS.length; i++) {
      try {
        const proxy = PROXY_URLS[i];
        const res = await fetch(proxy + encodeURIComponent(url), { 
          timeout: 5000,
          headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' }
        });
        if (res.ok) {
          return await res.text();
        }
      } catch (e) {
        console.log("Proxy failed, trying next one");
      }
    }
    return "";
  }

  // 1. Sports Data Sources
  async function getSportsData() {
    // Multiple sources for different leagues
    const sources = [
      // ESPN Sources
      { league: "NFL", label: "NFL", url: "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard" },
      { league: "NBA", label: "NBA", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard" },
      { league: "MLB", label: "MLB", url: "https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard" },
      { league: "NHL", label: "NHL", url: "https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard" },
      { league: "MLS", label: "MLS", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/usa.1/scoreboard" },
      
      // College Sports
      { league: "NCAAF", label: "CFB", url: "https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard?limit=25&groups=80" },
      { league: "NCAAB", label: "CBB", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard?limit=25&groups=50" },
      
      // International Soccer
      { league: "EPL", label: "EPL", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/scoreboard" },
      { league: "LALIGA", label: "LIGA", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/esp.1/scoreboard" },
      { league: "BUNDESLIGA", label: "BUND", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/ger.1/scoreboard" },
      { league: "SERIEA", label: "SERIE", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/ita.1/scoreboard" },
      
      // Other Major Sports
      { league: "F1", label: "F1", url: "https://site.api.espn.com/apis/site/v2/sports/racing/f1/scoreboard" },
      { league: "PGA", label: "PGA", url: "https://site.api.espn.com/apis/site/v2/sports/golf/pga/scoreboard" }
    ];

    let items = [];
    
    for (const source of sources) {
      try {
        const data = await fetchData(source.url);
        const events = data.events || [];
        
        // Process up to 3 games per league to keep the rotation diverse
        for (const ev of events.slice(0, 3)) {
          const comp = ev.competitions[0];
          const status = ev.status.type.state; // pre, in, post
          const detail = ev.status.type.shortDetail;
          
          // Skip events that are too far in the future (more than 1 day away)
          if (status === "pre") {
            const eventDate = new Date(ev.date);
            const now = new Date();
            const diffTime = Math.abs(eventDate - now);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays > 1) continue;
          }
          
          // Process competitors
          if (comp.competitors && comp.competitors.length >= 2) {
            const home = comp.competitors.find(team => team.homeAway === "home") || comp.competitors[0];
            const away = comp.competitors.find(team => team.homeAway === "away") || comp.competitors[1];
            
            // Team names with rankings if available
            let homeName = home.team.abbreviation || home.team.shortDisplayName;
            let awayName = away.team.abbreviation || away.team.shortDisplayName;
            
            if (home.curatedRank && home.curatedRank.current <= 25) {
              homeName = `#${home.curatedRank.current} ${homeName}`;
            }
            
            if (away.curatedRank && away.curatedRank.current <= 25) {
              awayName = `#${away.curatedRank.current} ${awayName}`;
            }
            
            const homeScore = home.score;
            const awayScore = away.score;
            
            // Create the HTML for this event
            let statusClass = "";
            let statusText = "";
            let mainHtml = "";
            
            if (status === "in") {
              statusClass = "status status-live";
              statusText = "LIVE";
              mainHtml = `<span class="team-name">${awayName}</span> <span class="team-score">${awayScore}</span> @ <span class="team-name">${homeName}</span> <span class="team-score">${homeScore}</span> <span style="color:#FF5555; margin-left:8px;">${detail}</span>`;
            } else if (status === "post") {
              statusClass = "status status-final";
              statusText = "FINAL";
              mainHtml = `<span class="team-name">${awayName}</span> <span class="team-score">${awayScore}</span> @ <span class="team-name">${homeName}</span> <span class="team-score">${homeScore}</span>`;
            } else {
              statusClass = "status status-upcoming";
              statusText = detail;
              mainHtml = `<span class="team-name">${awayName}</span> @ <span class="team-name">${homeName}</span>`;
            }
            
            // Get top performer stats if game is in progress or completed
            let playerStatsHtml = "";
            if (status === "in" || status === "post") {
              if (comp.leaders && comp.leaders.length > 0 && comp.leaders[0].leaders && comp.leaders[0].leaders.length > 0) {
                const topCategory = comp.leaders[0];
                const topPlayer = topCategory.leaders[0];
                const playerName = topPlayer.athlete?.shortName || topPlayer.athlete?.displayName || "Player";
                const statValue = topPlayer.displayValue;
                const statName = topCategory.shortDisplayName || topCategory.displayName;
                
                playerStatsHtml = `<span class="player-stats">‚≠ê ${playerName}: ${statValue} ${statName}</span>`;
              }
            }
            
            // Add to items array
            items.push({
              html: `<div class="league-badge ${source.league.toLowerCase()}">${source.label}</div> ${mainHtml} <span class="${statusClass}">${statusText}</span> ${playerStatsHtml}`
            });
          }
        }
      } catch (error) {
        console.error(`Error fetching ${source.league} data:`, error);
      }
    }
    
    return items;
  }

  // 2. News from Multiple Sources
  async function getSportsNews() {
    // Multiple news sources
    const sources = [
      { name: "ESPN NFL", url: "https://www.espn.com/espn/rss/nfl/news" },
      { name: "ESPN NBA", url: "https://www.espn.com/espn/rss/nba/news" },
      { name: "ESPN MLB", url: "https://www.espn.com/espn/rss/mlb/news" },
      { name: "ESPN NHL", url: "https://www.espn.com/espn/rss/nhl/news" },
      { name: "CBS Sports", url: "https://www.cbssports.com/rss/headlines/" },
      { name: "Yahoo Sports", url: "https://sports.yahoo.com/rss/" },
      { name: "FOX Sports", url: "https://api.foxsports.com/v1/rss?partnerKey=zBaFxRyGKCfxBagJG9b8pqLyndmvo7UU" }
    ];
    
    let newsItems = [];
    const parser = new DOMParser();
    
    // Get 2 news items from each source
    for (const source of sources) {
      try {
        const xmlStr = await fetchText(source.url);
        if (!xmlStr) continue;
        
        const xml = parser.parseFromString(xmlStr, "text/xml");
        const items = Array.from(xml.querySelectorAll("item")).slice(0, 2);
        
        for (const item of items) {
          const title = item.querySelector("title")?.textContent.replace("<![CDATA[", "").replace("]]>", "") || "";
          if (title) {
            newsItems.push({
              html: `<div class="league-badge news">NEWS</div> ${title}`
            });
          }
        }
      } catch (error) {
        console.error(`Error fetching news from ${source.name}:`, error);
      }
    }
    
    return newsItems;
  }

  // 3. Generate Engagement Content
  function getEngagementContent() {
    const messages = [
      "POLL: Who will win MVP this season? Reply with your pick!",
      "SOCIAL: Follow @NotSoCj on all platforms for more updates",
      "TRIVIA: Which team has the most championships in NBA history?",
      "INTERACT: Drop a üî• if you're enjoying the stream!",
      "QUESTION: Who's your all-time favorite athlete?",
      "PREDICTION: Will we see a new champion this year?",
      "DISCUSS: Greatest sports comeback of all time?",
      "DEBATE: Jordan vs LeBron - who's the GOAT?",
      "POLL: Best sports city in America? Reply with your pick!"
    ];
    
    // Shuffle and take 3 random engagement messages
    const shuffled = [...messages].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 3).map(msg => ({
      html: `<div class="league-badge live">LIVE</div> ${msg}`
    }));
  }

  // ============ RENDER & ANIMATE ============
  async function buildTicker() {
    try {
      // Get all data in parallel
      const [sportsData, newsData] = await Promise.all([
        getSportsData(),
        getSportsNews()
      ]);
      
      const engagementData = getEngagementContent();
      
      // Combine all data
      let allItems = [...sportsData, ...newsData, ...engagementData];
      
      // Shuffle to mix different content types
      allItems.sort(() => Math.random() - 0.5);
      
      // If no data, show loading message
      if (allItems.length === 0) {
        allItems = [{ html: "<div class='league-badge'>INFO</div> Loading sports data... Please wait." }];
      }
      
      // Clear and rebuild the track
      track.innerHTML = "";
      
      allItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "ticker-item";
        div.innerHTML = item.html;
        track.appendChild(div);
      });
      
      // Duplicate content for seamless loop
      track.innerHTML += track.innerHTML;
      
      // Update content width for animation
      contentWidth = track.scrollWidth / 2;
      
    } catch (error) {
      console.error("Error building ticker:", error);
      track.innerHTML = "<div class='ticker-item'><div class='league-badge'>ERROR</div> Unable to load sports data. Retrying...</div>";
    }
  }

  function animate(now) {
    if (!lastTime) lastTime = now;
    const dt = now - lastTime;
    
    lastTime = now;
    const move = (SPEED_PX_PER_SEC / 1000) * dt;
    scrollPosition += move;
    
    if (scrollPosition >= contentWidth) {
      scrollPosition = 0;
    }
    
    track.style.transform = `translateX(-${scrollPosition}px)`;
    requestAnimationFrame(animate);
  }

  // Initialize
  buildTicker();
  setInterval(buildTicker, REFRESH_INTERVAL_MS);
  requestAnimationFrame(animate);
  
  // Start typewriter animation
  resetTypewriter();
</script>
</body>
</html>