<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>COSMIC SPORTS TICKER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Barlow:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* --- BASE STYLES --- */
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: 'Barlow', sans-serif;
    background: #000;
  }

  /* --- SPACE BACKGROUND ANIMATIONS --- */
  .galaxy-bg {
    position: fixed;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, #000235, #000010);
    overflow: hidden;
    z-index: 1;
  }
  
  .stars {
    position: absolute;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(2px 2px at 20px 30px, #fff, rgba(0,0,0,0)),
      radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0)),
      radial-gradient(1px 1px at 90px 40px, #fff, rgba(0,0,0,0)),
      radial-gradient(2px 2px at 160px 120px, #fff, rgba(0,0,0,0)),
      radial-gradient(1px 1px at 200px 80px, #fff, rgba(0,0,0,0)),
      radial-gradient(2px 2px at 300px 50px, #fff, rgba(0,0,0,0)),
      radial-gradient(1px 1px at 400px 180px, #fff, rgba(0,0,0,0)),
      radial-gradient(1px 1px at 500px 20px, #fff, rgba(0,0,0,0));
    background-repeat: repeat;
    background-size: 550px 550px;
    opacity: 0.8;
    animation: twinkle 10s ease infinite;
  }
  
  @keyframes twinkle {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
  }
  
  .nebula {
    position: absolute;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(ellipse at 20% 20%, rgba(70,0,120,0.2), transparent 70%),
      radial-gradient(ellipse at 80% 40%, rgba(0,40,180,0.2), transparent 70%),
      radial-gradient(ellipse at 50% 70%, rgba(60,10,90,0.2), transparent 70%);
    opacity: 0.7;
    mix-blend-mode: screen;
    animation: drift 40s ease-in-out infinite alternate;
  }
  
  @keyframes drift {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }
  
  /* Planet */
  .planet {
    position: absolute;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: conic-gradient(#003366, #0066cc, #003366);
    box-shadow: 
      inset 5px -5px 15px rgba(255,255,255,0.3),
      0 0 20px 5px rgba(100,200,255,0.5);
    right: 15%;
    top: -35px;
    z-index: 3;
    transform-style: preserve-3d;
    animation: orbit 80s linear infinite;
  }
  
  .ring {
    position: absolute;
    width: 110px;
    height: 20px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotateX(75deg);
    border-radius: 50%;
    border: 4px solid rgba(160,220,255,0.2);
    box-shadow: 0 0 15px rgba(100,200,255,0.3);
  }
  
  @keyframes orbit {
    0% { transform: translateY(-35px) rotate(0deg); }
    50% { transform: translateY(calc(100vh + 35px)) rotate(180deg); }
    100% { transform: translateY(-35px) rotate(360deg); }
  }
  
  /* Shooting Stars */
  .shooting-star {
    position: absolute;
    width: 200px;
    height: 1px;
    transform-origin: right;
    z-index: 2;
    opacity: 0;
  }
  
  .shooting-star:before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(to left, rgba(255,255,255,0.8), transparent);
    filter: blur(1px);
  }
  
  .shooting-star:nth-child(1) {
    top: 15%;
    left: 20%;
    animation: shoot 6s linear infinite;
    animation-delay: 0s;
  }
  
  .shooting-star:nth-child(2) {
    top: 50%;
    left: 40%;
    animation: shoot 8s linear infinite;
    animation-delay: 3s;
  }
  
  .shooting-star:nth-child(3) {
    top: 30%;
    left: 60%;
    animation: shoot 5s linear infinite;
    animation-delay: 5s;
  }
  
  @keyframes shoot {
    0% { transform: rotate(20deg) translateX(0); opacity: 0; }
    5% { opacity: 1; }
    20% { transform: rotate(20deg) translateX(-500px); opacity: 0; }
    100% { opacity: 0; }
  }

  /* --- TICKER CONTAINER --- */
  .sports-ticker {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 70px;
    z-index: 10;
    display: flex;
    box-shadow: 0 -5px 25px rgba(0,100,255,0.4);
  }

  /* --- LEFT: LOGO SECTION --- */
  .ticker-logo {
    width: 180px;
    min-width: 180px;
    height: 100%;
    background: rgba(0,0,20,0.9);
    border-right: 2px solid #0077ee;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 12;
  }
  
  .title {
    font-family: 'Orbitron', sans-serif;
    font-size: 28px;
    font-weight: 900;
    color: #ffffff;
    text-shadow: 0 0 15px #0077ee;
    overflow: hidden;
    white-space: nowrap;
    border-right: 3px solid #00eeff;
    width: 0;
    animation: type-effect 3s steps(10) forwards, cursor-blink 0.7s step-end infinite;
  }
  
  @keyframes type-effect {
    from { width: 0 }
    to { width: 160px }
  }
  
  @keyframes cursor-blink {
    from, to { border-color: transparent }
    50% { border-color: #00eeff }
  }
  
  .tagline {
    font-size: 11px;
    color: #00ccff;
    font-weight: 600;
    text-transform: uppercase;
    margin-top: 6px;
  }

  /* --- CENTER: CONTENT AREA --- */
  .ticker-content {
    flex: 1;
    height: 100%;
    position: relative;
    background: rgba(0,5,20,0.85);
  }
  
  .ticker-rows {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .ticker-row {
    height: 50%;
    width: 100%;
    display: flex;
    align-items: center;
    overflow: hidden;
    position: relative;
  }
  
  .ticker-row:first-child {
    border-bottom: 1px solid #0077ee;
  }
  
  .scrolling-items {
    position: absolute;
    display: flex;
    align-items: center;
    white-space: nowrap;
    left: 0;
    height: 100%;
  }
  
  .scores-feed {
    animation: scroll-ticker 35s linear infinite;
  }
  
  .news-feed {
    animation: scroll-ticker 40s linear infinite;
  }
  
  @keyframes scroll-ticker {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
  
  .ticker-item {
    display: flex;
    align-items: center;
    margin-right: 40px;
    font-size: 17px;
    color: white;
    height: 100%;
    padding: 0 5px;
  }
  
  /* League Labels */
  .league-badge {
    background-color: #0077ee;
    color: white;
    font-weight: 700;
    padding: 2px 7px;
    margin-right: 10px;
    font-size: 13px;
    text-transform: uppercase;
  }
  
  /* Sport-specific colors */
  .nfl { background-color: #013369; }
  .nba { background-color: #C9082A; }
  .mlb { background-color: #041E42; }
  .nhl { background-color: #000000; border: 1px solid #ccc; }
  .soccer { background-color: #1EB53A; }
  .cfb { background-color: #7B6545; }
  .cbb { background-color: #4B328F; }
  .news { background-color: #7D3C98; }
  
  /* Houston Highlight */
  .houston {
    color: #ff5500;
    font-weight: 700;
    text-shadow: 0 0 8px rgba(255,85,0,0.4);
  }
  
  /* Game Status */
  .status {
    font-size: 11px;
    font-weight: 700;
    padding: 2px 6px;
    margin-left: 8px;
    text-transform: uppercase;
  }
  
  .live {
    background-color: #ff0000;
    color: white;
    animation: pulse 1.5s infinite;
  }
  
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
  }
  
  .final {
    background-color: #333333;
    color: white;
  }
  
  .upcoming {
    background-color: #555555;
    color: white;
  }
  
  /* Text Styles */
  .team { font-weight: 700; }
  .score { font-weight: 700; margin: 0 4px; }
  .player-stat { color: #00eeff; margin-left: 10px; font-size: 15px; }
  
  /* Separator Dot */
  .dot {
    width: 4px;
    height: 4px;
    background-color: #0077ee;
    border-radius: 50%;
    margin: 0 15px;
    display: inline-block;
  }
  
  /* --- RIGHT: CLOCK SECTION --- */
  .ticker-clock {
    width: 110px;
    min-width: 110px;
    height: 100%;
    background: rgba(0,0,20,0.9);
    border-left: 2px solid #0077ee;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 12;
  }
  
  #time {
    font-family: 'Orbitron', sans-serif;
    font-size: 22px;
    font-weight: 700;
    color: white;
    text-shadow: 0 0 10px #0077ee;
  }
  
  #date {
    font-size: 12px;
    color: #00ccff;
    font-weight: 600;
    margin-top: 2px;
    text-transform: uppercase;
  }
  
  /* Loading Indicator */
  .loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #00ccff;
    font-size: 14px;
    text-align: center;
    z-index: 100;
  }
  
  .loading:after {
    content: '';
    animation: loading-dots 1.5s steps(4, end) infinite;
  }
  
  @keyframes loading-dots {
    0% { content: ''; }
    25% { content: '.'; }
    50% { content: '..'; }
    75% { content: '...'; }
  }
</style>
</head>

<body>

<div class="galaxy-bg">
  <div class="stars"></div>
  <div class="nebula"></div>
  <div class="planet"><div class="ring"></div></div>
  <div class="shooting-star"></div>
  <div class="shooting-star"></div>
  <div class="shooting-star"></div>
</div>

<div class="sports-ticker">
  
  <div class="ticker-logo">
    <div class="title">NSN SPORTS</div>
    <div class="tagline">Powered by NotSoCj⭐️</div>
  </div>
  
  <div class="ticker-content">
    <div class="ticker-rows">
      <div class="ticker-row">
        <div class="scrolling-items scores-feed" id="scores-feed">
          </div>
      </div>
      
      <div class="ticker-row">
        <div class="scrolling-items news-feed" id="news-feed">
          </div>
      </div>
    </div>
    <div id="loading" class="loading">Loading sports data</div>
  </div>
  
  <div class="ticker-clock">
    <div id="time">--:--</div>
    <div id="date">--/--</div>
  </div>
  
</div>

<script>
// ============ CONFIGURATION & CONSTANTS ============
const PROXIES = [
  "https://corsproxy.io/?",
  "https://api.allorigins.win/raw?url=",
  "https://cors-anywhere.herokuapp.com/",
  "https://thingproxy.freeboard.io/fetch/"
];

const REFRESH_INTERVAL = 60000; // 1 minute
const HOUSTON_TEAMS = [
  "HOU", "Rockets", "Texans", "Astros", "Dynamo", "Dash", "Cougars", "Owls", "Houston"
];

// Default data in case APIs fail completely
const DEFAULT_SCORES = [
  { league: "NBA", badge: "nba", game: "<span class=\"team\">Warriors</span> <span class=\"score\">105</span> @ <span class=\"team\">Lakers</span> <span class=\"score\">112</span>", status: "<span class=\"status final\">FINAL</span>" },
  { league: "NFL", badge: "nfl", game: "<span class=\"houston\">Texans</span> <span class=\"score\">24</span> @ <span class=\"team\">Cowboys</span> <span class=\"score\">21</span>", status: "<span class=\"status final\">FINAL</span>" },
  { league: "MLB", badge: "mlb", game: "<span class=\"team\">Yankees</span> <span class=\"score\">3</span> @ <span class=\"houston\">Astros</span> <span class=\"score\">5</span>", status: "<span class=\"status final\">FINAL</span>" },
  { league: "NHL", badge: "nhl", game: "<span class=\"team\">Bruins</span> <span class=\"score\">2</span> @ <span class=\"team\">Stars</span> <span class=\"score\">3</span>", status: "<span class=\"status final\">FINAL</span>" },
  { league: "NBA", badge: "nba", game: "<span class=\"houston\">Rockets</span> <span class=\"score\">118</span> @ <span class=\"team\">Spurs</span> <span class=\"score\">109</span>", status: "<span class=\"status live\">LIVE</span>" },
  { league: "CFB", badge: "cfb", game: "<span class=\"team\">Alabama</span> <span class=\"score\">35</span> @ <span class=\"team\">Georgia</span> <span class=\"score\">28</span>", status: "<span class=\"status final\">FINAL</span>" },
  { league: "SOCCER", badge: "soccer", game: "<span class=\"team\">Man United</span> <span class=\"score\">2</span> @ <span class=\"team\">Liverpool</span> <span class=\"score\">1</span>", status: "<span class=\"status final\">FINAL</span>" }
];

const DEFAULT_NEWS = [
  { badge: "news", title: "<span class=\"houston\">Rockets</span> rookie impresses in debut with double-double" },
  { badge: "news", title: "NFL playoff race heats up as Week 12 approaches" },
  { badge: "news", title: "Lakers and Celtics renew historic rivalry with Christmas Day matchup" },
  { badge: "news", title: "<span class=\"houston\">Astros</span> sign top free agent pitcher to 5-year deal" },
  { badge: "news", title: "NFL considering expansion to 18-game regular season" },
  { badge: "news", title: "College Football Playoff committee releases first rankings" }
];

let apiAttempts = 0;
const MAX_ATTEMPTS = 3;
let useDefaultData = false;

// ============ CLOCK LOGIC ============
function updateClock() {
  const now = new Date();
  const timeString = now.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
  const dateString = now.toLocaleDateString("en-US", { month: "short", day: "numeric" });
  document.getElementById('time').textContent = timeString;
  document.getElementById('date').textContent = dateString.toUpperCase();
}

// Initialize clock
updateClock();
setInterval(updateClock, 1000);

// Reset typewriter effect periodically to make it look alive
function resetTypewriter() {
  const title = document.querySelector('.title');
  title.style.animation = 'none';
  void title.offsetWidth; // Force reflow
  title.style.animation = 'type-effect 3s steps(10) forwards, cursor-blink 0.7s step-end infinite';
}
setInterval(resetTypewriter, 10000);

// ============ DATA FETCHING UTILITIES ============
async function fetchWithTimeout(url, options = {}, timeout = 5000) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    throw error;
  }
}

async function getJsonData(url) {
  // Try each proxy until one works
  for (let i = 0; i < PROXIES.length; i++) {
    try {
      const proxy = PROXIES[i];
      const response = await fetchWithTimeout(proxy + encodeURIComponent(url), {
        headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' }
      });
      
      if (response.ok) {
        return await response.json();
      }
    } catch (error) {
      console.warn(`Proxy ${i+1} failed:`, error.message);
    }
  }
  throw new Error("All proxies failed");
}

async function getXmlData(url) {
  for (let i = 0; i < PROXIES.length; i++) {
    try {
      const proxy = PROXIES[i];
      const response = await fetchWithTimeout(proxy + encodeURIComponent(url), {
        headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' }
      });
      if (response.ok) {
        return await response.text();
      }
    } catch (error) {
      console.warn(`XML proxy ${i+1} failed:`, error.message);
    }
  }
  throw new Error("All XML proxies failed");
}

// Check for Houston teams
function isHoustonTeam(teamName) {
  if (!teamName) return false;
  return HOUSTON_TEAMS.some(term => teamName.includes(term));
}

// ============ CORE LOGIC: SCORES ============
async function getSportsData() {
  if (useDefaultData) {
    return DEFAULT_SCORES.map(item => ({
      html: `<span class="league-badge ${item.badge}">${item.league}</span> ${item.game} ${item.status}`,
      priority: item.game.includes("houston") ? 10 : 1
    }));
  }
  
  const leagues = [
    { code: "NFL", badge: "nfl", url: "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard" },
    { code: "NBA", badge: "nba", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard" },
    { code: "MLB", badge: "mlb", url: "https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard" },
    { code: "NHL", badge: "nhl", url: "https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard" },
    { code: "CFB", badge: "cfb", url: "https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard?limit=25&groups=80" },
    { code: "CBB", badge: "cbb", url: "https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard?limit=25&groups=50" },
    { code: "SOCCER", badge: "soccer", url: "https://site.api.espn.com/apis/site/v2/sports/soccer/usa.1/scoreboard" }
  ];

  let gameItems = [];
  let apiSuccess = false;
  
  for (const league of leagues) {
    try {
      const data = await getJsonData(league.url);
      
      if (!data || !data.events) continue;
      
      apiSuccess = true;
      const events = data.events || [];
      
      // Process games (limited to 5 per league to keep ticker moving)
      for (const event of events.slice(0, 5)) {
        if (!event.competitions || !event.competitions[0]) continue;
        
        const game = event.competitions[0];
        const gameState = event.status?.type?.state || "unknown"; // pre, in, post
        const gameDetail = event.status?.type?.shortDetail || "";
        
        if (!game.competitors || game.competitors.length < 2) continue;
        
        const homeTeam = game.competitors.find(team => team.homeAway === "home") || game.competitors[0];
        const awayTeam = game.competitors.find(team => team.homeAway === "away") || game.competitors[1];
        
        if (!homeTeam.team || !awayTeam.team) continue;
        
        // Team names with rankings
        let homeName = homeTeam.team.abbreviation || homeTeam.team.shortDisplayName || "Home";
        let awayName = awayTeam.team.abbreviation || awayTeam.team.shortDisplayName || "Away";
        
        const isHomeHouston = isHoustonTeam(homeTeam.team.displayName);
        const isAwayHouston = isHoustonTeam(awayTeam.team.displayName);
        
        if (homeTeam.curatedRank && homeTeam.curatedRank.current <= 25) {
          homeName = `#${homeTeam.curatedRank.current} ${homeName}`;
        }
        if (awayTeam.curatedRank && awayTeam.curatedRank.current <= 25) {
          awayName = `#${awayTeam.curatedRank.current} ${awayName}`;
        }
        
        const homeScore = homeTeam.score || "0";
        const awayScore = awayTeam.score || "0";
        
        const homeNameHTML = isHomeHouston ? `<span class="houston">${homeName}</span>` : `<span class="team">${homeName}</span>`;
        const awayNameHTML = isAwayHouston ? `<span class="houston">${awayName}</span>` : `<span class="team">${awayName}</span>`;
        
        let statusHTML = "";
        let gameHTML = "";
        
        if (gameState === "in") {
          statusHTML = `<span class="status live">LIVE</span>`;
          gameHTML = `${awayNameHTML} <span class="score">${awayScore}</span> @ ${homeNameHTML} <span class="score">${homeScore}</span> ${gameDetail}`;
        } else if (gameState === "post") {
          statusHTML = `<span class="status final">FINAL</span>`;
          gameHTML = `${awayNameHTML} <span class="score">${awayScore}</span> @ ${homeNameHTML} <span class="score">${homeScore}</span>`;
        } else {
          statusHTML = `<span class="status upcoming">${gameDetail}</span>`;
          gameHTML = `${awayNameHTML} @ ${homeNameHTML}`;
        }
        
        // Player Highlight Extraction
        let playerHTML = "";
        if ((gameState === "in" || gameState === "post") && game.leaders && game.leaders.length > 0) {
            const statCategory = game.leaders[0];
            if(statCategory.leaders && statCategory.leaders.length > 0) {
                const topPlayer = statCategory.leaders[0];
                if (topPlayer && topPlayer.athlete) {
                    const playerName = topPlayer.athlete.shortName || topPlayer.athlete.displayName || "Player";
                    const statValue = topPlayer.displayValue;
                    const statType = statCategory.shortDisplayName || statCategory.displayName;
                    playerHTML = `<span class="player-stat">⭐ ${playerName}: ${statValue} ${statType}</span>`;
                }
            }
        }
        
        gameItems.push({
          html: `<span class="league-badge ${league.badge}">${league.code}</span> ${gameHTML} ${statusHTML} ${playerHTML}`,
          priority: (isHomeHouston || isAwayHouston) ? 10 : 1, 
          status: gameState 
        });
      }
    } catch (error) {
      console.error(`Error getting ${league.code} data:`, error);
    }
  }
  
  if (gameItems.length === 0 && !apiSuccess) {
    apiAttempts++;
    if (apiAttempts >= MAX_ATTEMPTS) {
      useDefaultData = true;
      return DEFAULT_SCORES.map(item => ({
        html: `<span class="league-badge ${item.badge}">${item.league}</span> ${item.game} ${item.status}`,
        priority: item.game.includes("houston") ? 10 : 1
      }));
    } else {
      throw new Error("No sports data available");
    }
  }
  
  // Sort: Houston teams first, then Live games
  gameItems.sort((a, b) => {
    if (a.priority !== b.priority) return b.priority - a.priority;
    if (a.status !== b.status) {
      if (a.status === "in") return -1;
      if (b.status === "in") return 1;
    }
    return 0;
  });
  
  return gameItems;
}

// ============ CORE LOGIC: NEWS ============
async function getNewsData() {
  if (useDefaultData) {
    return DEFAULT_NEWS.map(item => ({
      html: `<span class="league-badge ${item.badge}">NEWS</span> ${item.title}`,
      priority: item.title.toLowerCase().includes("houston") ? 10 : 1
    }));
  }
  
  const newsSources = [
    { name: "ESPN", url: "https://www.espn.com/espn/rss/news" },
    { name: "NBA", url: "https://www.espn.com/espn/rss/nba/news" },
    { name: "NFL", url: "https://www.espn.com/espn/rss/nfl/news" },
    { name: "MLB", url: "https://www.espn.com/espn/rss/mlb/news" }
  ];

  let newsItems = [];
  const parser = new DOMParser();
  
  for (const source of newsSources) {
    try {
      const xmlText = await getXmlData(source.url);
      if (!xmlText) continue;
      
      const xmlDoc = parser.parseFromString(xmlText, "text/xml");
      const items = xmlDoc.querySelectorAll("item");
      
      // Take top 3 stories from each source
      for (let i = 0; i < Math.min(items.length, 3); i++) {
        const item = items[i];
        const titleNode = item.querySelector("title");
        if (!titleNode) continue;
        
        let title = titleNode.textContent;
        // Clean up CDATA
        title = title.replace("<![CDATA[", "").replace("]]>", "").trim();
        
        const isHouston = isHoustonTeam(title);
        let formattedTitle = title;
        
        // Highlight Houston keywords
        if (isHouston) {
             HOUSTON_TEAMS.forEach(term => {
                 const regex = new RegExp(`\\b${term}\\b`, 'gi');
                 formattedTitle = formattedTitle.replace(regex, `<span class="houston">$&</span>`);
             });
        }

        newsItems.push({
          html: `<span class="league-badge news">NEWS</span> ${formattedTitle}`,
          priority: isHouston ? 10 : 1
        });
      }
    } catch (e) {
      console.warn(`Failed to fetch news from ${source.name}`, e);
    }
  }
  
  if (newsItems.length === 0) {
    return DEFAULT_NEWS.map(item => ({
      html: `<span class="league-badge ${item.badge}">NEWS</span> ${item.title}`,
      priority: item.title.toLowerCase().includes("houston") ? 10 : 1
    }));
  }
  
  // Shuffle standard items, keep Priority (Houston) items at top
  const priorityItems = newsItems.filter(i => i.priority > 1);
  const standardItems = newsItems.filter(i => i.priority === 1).sort(() => Math.random() - 0.5);
  
  return [...priorityItems, ...standardItems];
}

// ============ DOM MANIPULATION ============
function populateTicker(elementId, items) {
  const container = document.getElementById(elementId);
  if (!container) return;
  
  container.innerHTML = ""; 
  
  let contentHTML = "";
  items.forEach((item, index) => {
    contentHTML += `<div class="ticker-item">${item.html}</div>`;
    if (index < items.length - 1) {
      contentHTML += `<div class="dot"></div>`;
    }
  });
  
  // Inject
  container.innerHTML = contentHTML;
  
  // Duplicate for seamless scroll
  if (items.length > 0) {
      const separator = `<div class="dot"></div>`;
      container.innerHTML += separator + contentHTML;
  }
}

// ============ INITIALIZATION ============
async function initTicker() {
  const loading = document.getElementById('loading');
  
  try {
    // Fetch both concurrently
    const [scores, news] = await Promise.all([
      getSportsData(),
      getNewsData()
    ]);
    
    populateTicker('scores-feed', scores);
    populateTicker('news-feed', news);
    
    if (loading) loading.style.display = 'none';
    
  } catch (error) {
    console.error("Initialization error, using defaults:", error);
    useDefaultData = true;
    const scores = await getSportsData();
    const news = await getNewsData();
    populateTicker('scores-feed', scores);
    populateTicker('news-feed', news);
    if (loading) loading.style.display = 'none';
  }
}

document.addEventListener("DOMContentLoaded", () => {
  initTicker();
  setInterval(initTicker, REFRESH_INTERVAL);
});

</script>
</body>
</html>
